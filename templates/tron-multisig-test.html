<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRON Multisig Test - Account Permissions</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/font-awesome.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 20px;
        }
        .step-card {
            border-left: 5px solid #6c757d;
            transition: all 0.3s ease;
        }
        .step-card.active {
            border-left-color: #0d6efd;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
            animation: pulse-border 2s ease-in-out infinite;
        }
        .step-card.completed {
            border-left-color: #198754;
            background: #f0f9ff;
        }
        @keyframes pulse-border {
            0%, 100% {
                box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(13, 110, 253, 0.2);
            }
        }
        .log-area {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 5px;
        }
        .log-entry.success {
            color: #4ec9b0;
        }
        .log-entry.error {
            color: #f48771;
        }
        .log-entry.info {
            color: #569cd6;
        }
        .log-entry.warning {
            color: #dcdcaa;
        }
        .wallet-badge {
            background: white;
            color: #667eea;
            padding: 10px 15px;
            border-radius: 10px;
            display: inline-block;
            font-family: monospace;
            font-size: 14px;
        }
        .btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }
        .btn-gradient:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            color: white;
        }
        .info-badge {
            background: #e7f3ff;
            border-left: 4px solid #0d6efd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .warning-badge {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <!-- Header -->
        <div class="card">
            <div class="card-header">
                <h1 class="mb-0"><i class="fas fa-shield-alt"></i> TRON Multisig Test</h1>
                <p class="mb-0 mt-2" style="opacity: 0.9;">Account Permission Approach - –ù–∞—Ç–∏–≤–Ω–∞—è –º—É–ª—å—Ç–∏–ø–æ–¥–ø–∏—Å—å TRON</p>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-0">
                    <h5><i class="fas fa-info-circle"></i> –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h5>
                    <ol class="mb-0">
                        <li>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ TRON –∫–æ—à–µ–ª–µ–∫ (TronLink) - —ç—Ç–æ –±—É–¥–µ—Ç Owner1</li>
                        <li>–ü—Ä–æ–≤–µ—Ä—è–µ–º multisig permissions –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ Owner1</li>
                        <li>–°–æ–∑–¥–∞—ë–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å permission_id</li>
                        <li>–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ TronLink (Owner1)</li>
                        <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å Owner2</li>
                        <li>–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ TRON mainnet</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Step 0: Connect Wallet -->
        <div class="card step-card" :class="{ completed: walletConnected }">
            <div class="card-body">
                <h4><i class="fas fa-wallet"></i> –®–∞–≥ 0: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</h4>
                <div v-if="!walletConnected">
                    <div class="warning-badge mb-3">
                        <strong><i class="fas fa-exclamation-triangle"></i> –ü–µ—Ä–µ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º:</strong>
                        <ol class="mb-0 mt-2">
                            <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ TronLink —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</li>
                            <li><strong>–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –∫–æ—à–µ–ª–µ–∫ TronLink</strong> (–≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å)</li>
                            <li>–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ <strong>TRON Mainnet</strong></li>
                            <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–∫–ª—é—á–∏—Ç—å TronLink"</li>
                        </ol>
                        <div class="mt-2" style="font-size: 0.9em; opacity: 0.8;">
                            <strong>üí° Chrome:</strong> –ï—Å–ª–∏ TronLink –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:
                            <ul class="mb-0 mt-1">
                                <li>–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5) –ø–æ—Å–ª–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ TronLink</li>
                                <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ TronLink –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å —Å—é–¥–∞</li>
                            </ul>
                        </div>
                    </div>
                    <button class="btn btn-gradient btn-lg" @click="connectWallet" :disabled="loading">
                        <i class="fas fa-plug"></i> 
                        <span v-if="loading">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                        <span v-else>–ü–æ–¥–∫–ª—é—á–∏—Ç—å TronLink</span>
                    </button>
                </div>
                <div v-else>
                    <div class="alert alert-success mb-0">
                        <strong>‚úì –ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω</strong><br>
                        <span class="wallet-badge">[[ walletAddress ]]</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 1: Initialize Config -->
        <div class="card step-card" :class="{ active: walletConnected && !configLoaded, completed: configLoaded }" v-if="walletConnected">
            <div class="card-body">
                <h4><i class="fas fa-cog"></i> –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h4>
                <div v-if="!configLoaded">
                    <p class="text-muted">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º—É–ª—å—Ç–∏–ø–æ–¥–ø–∏—Å–∏ –∏–∑ –º–Ω–µ–º–æ–Ω–∏–∫ (2/3)</p>
                    <button class="btn btn-gradient" @click="loadConfig" :disabled="loading">
                        <i class="fas fa-download"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                    </button>
                </div>
                <div v-else>
                    <div class="alert alert-success">
                        <strong>‚úì –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞</strong>
                        <div class="mt-2">
                            <strong>–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–µ–π:</strong> [[config.required_signatures]]/[[config.total_owners]]
                        </div>
                        <div class="mt-2">
                            <strong>–í–ª–∞–¥–µ–ª—å—Ü—ã:</strong>
                            <ul class="mb-0 mt-1">
                                <li><code>[[ config.owner1_address ]]</code> <span class="badge bg-primary">Owner1 (–í—ã)</span></li>
                                <li><code>[[ config.owner2_address ]]</code> <span class="badge bg-secondary">Owner2 (–ê–≤—Ç–æ)</span></li>
                                <li><code>[[ config.owner3_address ]]</code> <span class="badge bg-secondary">Owner3</span></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="info-badge">
                        <strong><i class="fas fa-lightbulb"></i> –í–∞–∂–Ω–æ:</strong>
                        –ê–∫–∫–∞—É–Ω—Ç Owner1 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å multisig permissions (2/3).
                        –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –Ω–µ–≥–æ —Ç—Ä–µ–±—É—é—Ç 2 –ø–æ–¥–ø–∏—Å–∏ –∏–∑ 3 –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤.
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Check Permissions -->
        <div class="card step-card" :class="{ active: configLoaded && !permissionsChecked, completed: permissionsChecked }" v-if="configLoaded">
            <div class="card-body">
                <h4><i class="fas fa-key"></i> –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ Permissions</h4>
                <div v-if="!permissionsChecked">
                    <p class="text-muted">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å multisig permissions –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ Owner1</p>
                    <button class="btn btn-gradient" @click="checkPermissions" :disabled="loading">
                        <i class="fas fa-search"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Permissions
                    </button>
                </div>
                <div v-else>
                    <div v-if="hasMultisig" class="alert alert-success">
                        <strong>‚úì Multisig permissions –Ω–∞–π–¥–µ–Ω—ã!</strong>
                        <div class="mt-2">
                            <strong>Permission ID:</strong> [[ permissionId ]]<br>
                            <strong>Permission Name:</strong> [[ permissionName ]]<br>
                            <strong>Threshold:</strong> [[ permissionThreshold ]]<br>
                            <strong>Keys:</strong> [[ permissionKeysCount ]]
                        </div>
                    </div>
                    <div v-else class="alert alert-warning">
                        <strong>‚ö† Multisig permissions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</strong>
                        <p class="mb-0 mt-2">
                            –ê–∫–∫–∞—É–Ω—Ç Owner1 –Ω–µ –∏–º–µ–µ—Ç multisig permissions.<br>
                            –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å permissions —á–µ—Ä–µ–∑ AccountPermissionUpdateContract.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Create Transaction -->
        <div class="card step-card" :class="{ active: hasMultisig && !transactionCreated, completed: transactionCreated }" v-if="hasMultisig">
            <div class="card-body">
                <h4><i class="fas fa-file-invoice"></i> –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h4>
                <div v-if="!transactionCreated">
                    <p class="text-muted">–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø–µ—Ä–µ–≤–æ–¥–∞ —Å multisig permission</p>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</label>
                            <input type="text" class="form-control" v-model="recipientAddress" placeholder="TRON –∞–¥—Ä–µ—Å">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">–°—É–º–º–∞ (TRX):</label>
                            <input type="number" class="form-control" v-model="amount" step="0.1" min="0.1">
                        </div>
                    </div>
                    
                    <button class="btn btn-gradient" @click="createTransaction" :disabled="loading || !recipientAddress || !amount">
                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                    </button>
                </div>
                <div v-else>
                    <div class="alert alert-success">
                        <strong>‚úì –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞</strong>
                        <div class="mt-2">
                            <strong>TX ID:</strong> <code>[[ txId ]]</code><br>
                            <strong>–û—Ç:</strong> <code>[[ walletAddress ]]</code><br>
                            <strong>–ö–æ–º—É:</strong> <code>[[ recipientAddress ]]</code><br>
                            <strong>–°—É–º–º–∞:</strong> [[ amount ]] TRX
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Sign Transaction -->
        <div class="card step-card" :class="{ active: transactionCreated && !transactionSigned, completed: transactionSigned }" v-if="transactionCreated">
            <div class="card-body">
                <h4><i class="fas fa-signature"></i> –®–∞–≥ 4: –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h4>
                <div v-if="!transactionSigned">
                    <div class="info-badge mb-3">
                        <strong><i class="fas fa-info-circle"></i> –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–∞—à–∞ –ø–æ–¥–ø–∏—Å—å</strong>
                        <p class="mb-0 mt-2">
                            –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∏ –æ—Ç Owner1 (–≤–∞—à –∫–æ—à–µ–ª–µ–∫).<br>
                            TronLink –æ—Ç–∫—Ä–æ–µ—Ç –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏.
                        </p>
                    </div>
                    <button class="btn btn-gradient btn-lg w-100" @click="signTransaction" :disabled="loading" style="font-size: 1.1rem; padding: 12px;">
                        <i class="fas fa-pen"></i> 
                        <span v-if="loading">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏...</span>
                        <span v-else>‚úçÔ∏è –ü–æ–¥–ø–∏—Å–∞—Ç—å —á–µ—Ä–µ–∑ TronLink</span>
                    </button>
                </div>
                <div v-else>
                    <div class="alert alert-success">
                        <strong>‚úì –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω–∞</strong>
                        <div class="mt-2">
                            <strong>–ü–æ–¥–ø–∏—Å–µ–π:</strong> [[ signaturesCount ]] / [[ requiredSignatures ]]<br>
                            <strong>–ì–æ—Ç–æ–≤–∞ –∫ broadcast:</strong> [[ isReady ? '–î–∞ ‚úì' : '–ù–µ—Ç (–Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –ø–æ–¥–ø–∏—Å–µ–π)' ]]
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Broadcast Transaction -->
        <div class="card step-card" :class="{ active: isReady && !transactionBroadcast, completed: transactionBroadcast }" v-if="isReady">
            <div class="card-body">
                <h4><i class="fas fa-broadcast-tower"></i> –®–∞–≥ 5: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ TRON Mainnet</h4>
                <div v-if="!transactionBroadcast">
                    <div class="alert alert-success mb-3">
                        <strong><i class="fas fa-check-circle"></i> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≥–æ—Ç–æ–≤–∞!</strong>
                        <p class="mb-0 mt-2">
                            –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–¥–ø–∏—Å–∏ —Å–æ–±—Ä–∞–Ω—ã ([[ signaturesCount ]]/[[ requiredSignatures ]]).<br>
                            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ TRON Mainnet.
                        </p>
                    </div>
                    <button class="btn btn-success btn-lg w-100" @click="broadcastTransaction" :disabled="loading" style="font-size: 1.2rem; padding: 15px;">
                        <i class="fas fa-paper-plane"></i> 
                        <span v-if="loading">–û—Ç–ø—Ä–∞–≤–∫–∞...</span>
                        <span v-else>üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ TRON Mainnet</span>
                    </button>
                </div>
                <div v-else>
                    <div class="alert alert-success">
                        <strong>‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ Mainnet!</strong>
                        <div class="mt-3">
                            <strong>TX ID:</strong><br>
                            <code style="font-size: 0.9rem; word-break: break-all;">[[ broadcastTxId ]]</code>
                        </div>
                        <div class="mt-3">
                            <a :href="'https://tronscan.org/#/transaction/' + broadcastTxId" target="_blank" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-external-link-alt"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ TronScan
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-terminal"></i> –õ–æ–≥–∏</h4>
            </div>
            <div class="card-body">
                <div class="log-area" ref="logArea">
                    <div v-for="(log, index) in logs" :key="index" class="log-entry" :class="log.type">
                        <span class="text-muted">[[ log.time ]]</span> [[ log.message ]]
                    </div>
                </div>
                <div class="mt-3">
                    <button class="btn btn-sm btn-secondary" @click="clearLogs">
                        <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
                    </button>
                    <button class="btn btn-sm btn-warning ms-2" @click="resetAll">
                        <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/vue.min.js"></script>
    <script>
        new Vue({
            el: '#app',
            delimiters: ['[[', ']]'],
            data: {
                loading: false,
                
                // Wallet
                walletConnected: false,
                walletAddress: null,
                tronWeb: null,
                
                // Config
                configLoaded: false,
                config: null,
                
                // Permissions
                permissionsChecked: false,
                hasMultisig: false,
                permissionId: null,
                permissionName: null,
                permissionThreshold: null,
                permissionKeysCount: null,
                
                // Transaction
                transactionCreated: false,
                txId: null,
                rawDataHex: null,
                unsignedTransaction: null,
                recipientAddress: '',
                amount: 0.1,
                
                // Signing
                transactionSigned: false,
                signaturesCount: 0,
                requiredSignatures: 2,
                isReady: false,
                
                // Broadcast
                transactionBroadcast: false,
                broadcastTxId: null,
                
                // Logs
                logs: []
            },
            methods: {
                async connectWallet() {
                    this.loading = true;
                    this.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ TronLink...', 'info');
                    
                    try {
                        // –®–∞–≥ 1: –ñ–¥–µ–º –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è TronLink (–≤–∞–∂–Ω–æ –¥–ª—è Chrome)
                        this.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è TronLink...', 'info');
                        let attempts = 0;
                        const maxWaitAttempts = 30; // 3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                        
                        while (attempts < maxWaitAttempts) {
                            if (typeof window.tronWeb !== 'undefined') {
                                break;
                            }
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è TronWeb (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±)
                        if (typeof window.tronWeb === 'undefined') {
                            throw new Error('TronLink –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ TronLink.');
                        }
                        
                        this.log('‚úì TronLink –æ–±–Ω–∞—Ä—É–∂–µ–Ω', 'success');
                        
                        // –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                        const isLocked = !window.tronWeb.ready || 
                                        !window.tronWeb.defaultAddress || 
                                        window.tronWeb.defaultAddress.base58 === false;
                        
                        if (isLocked) {
                            this.log('üîí TronLink –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–∞–π—Ç—É', 'warning');
                            this.log('‚è≥ –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', 'info');
                            
                            // –Ø–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ tronLink API (–Ω–æ–≤—ã–π —Å–ø–æ—Å–æ–±)
                            if (window.tronLink) {
                                try {
                                    this.log('  –ò—Å–ø–æ–ª—å–∑—É—é tronLink.request()...', 'info');
                                    const res = await window.tronLink.request({ 
                                        method: 'tron_requestAccounts' 
                                    });
                                    
                                    if (res.code === 200) {
                                        this.log('  ‚úì –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ!', 'success');
                                    } else if (res.code === 4001) {
                                        throw new Error('–í—ã –æ—Ç–∫–ª–æ–Ω–∏–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ');
                                    }
                                } catch (e) {
                                    if (e.message && e.message.includes('–æ—Ç–∫–ª–æ–Ω–∏–ª–∏')) {
                                        throw e;
                                    }
                                    this.log('  ‚ö† –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞', 'warning');
                                }
                            }
                        }
                        
                        // –®–∞–≥ 3: –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ TronWeb –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞
                        this.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ TronWeb...', 'info');
                        attempts = 0;
                        const maxReadyAttempts = 50; // 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
                        
                        while (attempts < maxReadyAttempts) {
                            if (window.tronWeb && 
                                window.tronWeb.ready && 
                                window.tronWeb.defaultAddress &&
                                window.tronWeb.defaultAddress.base58 &&
                                window.tronWeb.defaultAddress.base58 !== false) {
                                
                                const address = window.tronWeb.defaultAddress.base58;
                                this.tronWeb = window.tronWeb;
                                this.walletAddress = address;
                                this.walletConnected = true;
                                this.log('‚úÖ –ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω: ' + this.walletAddress, 'success');
                                
                                // –õ–æ–≥–∏—Ä—É–µ–º –≤–µ—Ä—Å–∏—é TronWeb
                                if (window.tronWeb.version) {
                                    this.log('  TronWeb –≤–µ—Ä—Å–∏—è: ' + window.tronWeb.version, 'info');
                                }
                                
                                return;
                            }
                            
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                            
                            // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
                            if (attempts === 10) {
                                this.log('  ‚è≥ –í—Å–µ –µ—â–µ –∂–¥–µ–º... (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ TronLink —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)', 'warning');
                                console.log('TronWeb state:', {
                                    exists: !!window.tronWeb,
                                    ready: window.tronWeb?.ready,
                                    defaultAddress: window.tronWeb?.defaultAddress
                                });
                            }
                        }
                        
                        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
                        throw new Error('TronLink –Ω–µ –≥–æ—Ç–æ–≤. –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –∫–æ—à–µ–ª–µ–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                        
                    } catch (error) {
                        this.log('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
                        
                        if (error.message.includes('–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')) {
                            this.log('  üì• –†–µ—à–µ–Ω–∏–µ:', 'warning');
                            this.log('     1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ TronLink: https://www.tronlink.org/', 'warning');
                            this.log('     2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É', 'warning');
                        } else if (error.message.includes('–æ—Ç–∫–ª–æ–Ω–∏–ª–∏')) {
                            this.log('  üí° –†–µ—à–µ–Ω–∏–µ:', 'warning');
                            this.log('     –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å" —Å–Ω–æ–≤–∞ –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø', 'warning');
                        } else {
                            this.log('  üîì –†–µ—à–µ–Ω–∏–µ:', 'warning');
                            this.log('     1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ TronLink (–∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É)', 'warning');
                            this.log('     2. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏', 'warning');
                            this.log('     3. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å TronLink" —Å–Ω–æ–≤–∞', 'warning');
                        }
                        
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
                        console.error('Connection error details:', {
                            tronWebExists: typeof window.tronWeb !== 'undefined',
                            tronWebReady: window.tronWeb ? window.tronWeb.ready : null,
                            defaultAddress: window.tronWeb ? window.tronWeb.defaultAddress : null
                        });
                    } finally {
                        this.loading = false;
                    }
                },
                
                async loadConfig() {
                    this.loading = true;
                    this.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...', 'info');
                    
                    try {
                        const response = await fetch('/api/multisig/config');
                        const data = await response.json();
                        
                        if (data.success) {
                            this.config = data.config;
                            this.configLoaded = true;
                            this.requiredSignatures = data.config.required_signatures;
                            
                            this.log('‚úì ' + data.message, 'success');
                            this.log('  Owner1: ' + data.config.owner1_address, 'info');
                            this.log('  Owner2: ' + data.config.owner2_address, 'info');
                            this.log('  Owner3: ' + data.config.owner3_address, 'info');
                            
                            // Check if wallet matches owner1
                            if (this.walletAddress !== data.config.owner1_address) {
                                this.log('‚ö† –í–ù–ò–ú–ê–ù–ò–ï: –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å Owner1!', 'warning');
                                this.log('  –û–∂–∏–¥–∞–µ—Ç—Å—è: ' + data.config.owner1_address, 'warning');
                                this.log('  –ü–æ–¥–∫–ª—é—á–µ–Ω: ' + this.walletAddress, 'warning');
                            }
                        } else {
                            throw new Error(data.detail || 'Failed to load config');
                        }
                    } catch (error) {
                        this.log('‚úó –û—à–∏–±–∫–∞: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async checkPermissions() {
                    this.loading = true;
                    this.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ permissions –¥–ª—è ' + this.walletAddress + '...', 'info');
                    
                    try {
                        const response = await fetch('/api/multisig/check-permissions', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                owner_address: this.walletAddress
                            })
                        });
                        const data = await response.json();
                        
                        if (data.success) {
                            this.permissionsChecked = true;
                            this.hasMultisig = data.has_multisig;
                            
                            if (data.has_multisig) {
                                this.permissionId = data.permission_id;
                                this.permissionName = data.permission_name;
                                this.permissionThreshold = data.threshold;
                                this.permissionKeysCount = data.keys_count;
                                
                                this.log('‚úì ' + data.message, 'success');
                                this.log('  Permission ID: ' + data.permission_id, 'info');
                                this.log('  Threshold: ' + data.threshold, 'info');
                            } else {
                                this.log('‚ö† ' + data.message, 'warning');
                                this.log('  –ê–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è multisig', 'warning');
                            }
                        } else {
                            throw new Error(data.detail || 'Failed to check permissions');
                        }
                    } catch (error) {
                        this.log('‚úó –û—à–∏–±–∫–∞: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async createTransaction() {
                    this.loading = true;
                    this.log('–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...', 'info');
                    this.log('  –û—Ç: ' + this.walletAddress, 'info');
                    this.log('  –ö–æ–º—É: ' + this.recipientAddress, 'info');
                    this.log('  –°—É–º–º–∞: ' + this.amount + ' TRX', 'info');
                    this.log('  Permission ID: ' + this.permissionId, 'info');
                    
                    try {
                        const response = await fetch('/api/multisig/create-transaction', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                from_address: this.walletAddress,
                                to_address: this.recipientAddress,
                                amount_trx: parseFloat(this.amount),
                                permission_id: this.permissionId
                            })
                        });
                        const data = await response.json();
                        
                        if (data.success) {
                            this.txId = data.tx_id;
                            this.rawDataHex = data.raw_data_hex;
                            this.unsignedTransaction = data.unsigned_transaction; // Save full transaction
                            this.transactionCreated = true;
                            
                            this.log('‚úì ' + data.message, 'success');
                            this.log('  TX ID: ' + data.tx_id, 'info');
                            this.log('', 'info');
                            this.log('üëá –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –®–∞–≥—É 4 –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏', 'success');
                            
                            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                            this.$nextTick(() => {
                                setTimeout(() => {
                                    const step4 = document.querySelector('.card.step-card.active');
                                    if (step4) {
                                        step4.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                    }
                                }, 300);
                            });
                        } else {
                            throw new Error(data.detail || 'Failed to create transaction');
                        }
                    } catch (error) {
                        this.log('‚úó –û—à–∏–±–∫–∞: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async signTransaction() {
                    this.loading = true;
                    this.log('–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ TronLink...', 'info');
                    this.log('  TX ID: ' + this.txId, 'info');
                    this.log('  Wallet address: ' + this.walletAddress, 'info');
                    
                    try {
                        // –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞—Ç—å –ø–æ–ª–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ TronLink –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏
                        this.log('  –í—ã–∑–æ–≤ tronWeb.trx.sign() —Å –ø–æ–ª–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π...', 'info');
                        
                        // Sign –ø–æ–ª–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–Ω–µ raw_data_hex!)
                        const signedTx = await this.tronWeb.trx.sign(this.unsignedTransaction);
                        
                        this.log('  –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç TronLink', 'info');
                        this.log('  –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: ' + typeof signedTx, 'info');
                        
                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ–¥–ø–∏—Å—å –∏–∑ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                        let cleanSignature;
                        if (signedTx.signature && Array.isArray(signedTx.signature) && signedTx.signature.length > 0) {
                            cleanSignature = signedTx.signature[0];
                            this.log('  –ü–æ–¥–ø–∏—Å—å –∏–∑–≤–ª–µ—á–µ–Ω–∞ –∏–∑ –º–∞—Å—Å–∏–≤–∞ signature', 'info');
                        } else if (typeof signedTx === 'string') {
                            cleanSignature = signedTx;
                            this.log('  –ü–æ–¥–ø–∏—Å—å –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞', 'info');
                        } else {
                            throw new Error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç TronLink: ' + JSON.stringify(signedTx));
                        }
                        
                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å 0x –µ—Å–ª–∏ –µ—Å—Ç—å
                        if (cleanSignature.startsWith('0x')) {
                            cleanSignature = cleanSignature.substring(2);
                            this.log('  –£–±—Ä–∞–Ω –ø—Ä–µ—Ñ–∏–∫—Å 0x', 'info');
                        }
                        
                        this.log('‚úì –ü–æ–¥–ø–∏—Å—å –ø–æ–ª—É—á–µ–Ω–∞ –æ—Ç TronLink', 'success');
                        this.log('  Signature length: ' + cleanSignature.length, 'info');
                        this.log('  Signature (first 32): ' + cleanSignature.substring(0, 32) + '...', 'info');
                        
                        // Send signature to backend
                        const response = await fetch('/api/multisig/add-signature', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                tx_id: this.txId,
                                signature: cleanSignature,
                                signer_address: this.walletAddress
                            })
                        });
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.detail || 'Failed to add signature');
                        }
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.transactionSigned = true;
                            this.signaturesCount = data.signatures_count;
                            this.isReady = data.is_ready;
                            
                            this.log('‚úì ' + data.message, 'success');
                            this.log('  –ü–æ–¥–ø–∏—Å–µ–π: ' + data.signatures_count + '/' + data.required_signatures, 'info');
                            
                            if (data.is_ready) {
                                this.log('‚úì –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ broadcast!', 'success');
                                this.log('', 'info');
                                this.log('üëá –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –®–∞–≥—É 5 –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Å–µ—Ç—å', 'success');
                                
                                // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –®–∞–≥—É 5 (broadcast)
                                this.$nextTick(() => {
                                    setTimeout(() => {
                                        const step5 = document.querySelectorAll('.card.step-card')[4]; // –®–∞–≥ 5
                                        if (step5) {
                                            step5.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                        }
                                    }, 300);
                                });
                            }
                        } else {
                            throw new Error(data.detail || 'Failed to add signature');
                        }
                    } catch (error) {
                        this.log('‚úó –û—à–∏–±–∫–∞: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async broadcastTransaction() {
                    this.loading = true;
                    this.log('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ TRON mainnet...', 'info');
                    
                    try {
                        const response = await fetch('/api/multisig/broadcast', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                tx_id: this.txId
                            })
                        });
                        const data = await response.json();
                        
                        if (data.success && data.result) {
                            this.transactionBroadcast = true;
                            this.broadcastTxId = data.txid;
                            
                            this.log('‚úÖ ' + data.message, 'success');
                            this.log('  TronScan: https://tronscan.org/#/transaction/' + data.txid, 'success');
                        } else {
                            throw new Error(data.detail || 'Broadcast failed');
                        }
                    } catch (error) {
                        this.log('‚úó –û—à–∏–±–∫–∞ broadcast: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async resetAll() {
                    if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ?')) return;
                    
                    try {
                        await fetch('/api/multisig/reset');
                        
                        // Reset local state
                        this.configLoaded = false;
                        this.config = null;
                        this.permissionsChecked = false;
                        this.hasMultisig = false;
                        this.permissionId = null;
                        this.transactionCreated = false;
                        this.txId = null;
                        this.transactionSigned = false;
                        this.isReady = false;
                        this.transactionBroadcast = false;
                        this.recipientAddress = '';
                        this.amount = 0.1;
                        
                        this.log('‚úì –î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
                    } catch (error) {
                        this.log('‚úó –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞: ' + error.message, 'error');
                    }
                },
                
                log(message, type = 'info') {
                    const time = new Date().toLocaleTimeString('ru-RU');
                    this.logs.push({ time, message, type });
                    
                    this.$nextTick(() => {
                        if (this.$refs.logArea) {
                            this.$refs.logArea.scrollTop = this.$refs.logArea.scrollHeight;
                        }
                    });
                },
                
                clearLogs() {
                    this.logs = [];
                },
                
                setupTronLinkListeners() {
                    // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏–π TronLink (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±)
                    window.addEventListener('message', (e) => {
                        if (e.data.message && e.data.message.action === 'setAccount') {
                            // –ê–∫–∫–∞—É–Ω—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è
                            if (this.walletConnected && window.tronWeb && window.tronWeb.defaultAddress) {
                                const newAddress = window.tronWeb.defaultAddress.base58;
                                if (newAddress && newAddress !== this.walletAddress) {
                                    this.walletAddress = newAddress;
                                    this.log('‚ö† –ê–∫–∫–∞—É–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω: ' + this.walletAddress, 'warning');
                                }
                            }
                        } else if (e.data.message && e.data.message.action === 'disconnect') {
                            this.log('‚ö† TronLink –æ—Ç–∫–ª—é—á–µ–Ω', 'warning');
                            this.walletConnected = false;
                            this.walletAddress = null;
                        } else if (e.data.message && e.data.message.action === 'connect') {
                            // TronLink –ø–æ–¥–∫–ª—é—á–µ–Ω (–≤–∞–∂–Ω–æ –¥–ª—è Chrome)
                            this.log('‚úì TronLink –≥–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é', 'success');
                            this.checkAutoConnectPassive();
                        } else if (e.data.message && e.data.message.action === 'accountsChanged') {
                            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã –∞–∫–∫–∞—É–Ω—Ç–∞
                            this.log('üîÑ –ê–∫–∫–∞—É–Ω—Ç—ã –∏–∑–º–µ–Ω–µ–Ω—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...', 'info');
                            this.checkAutoConnectPassive();
                        }
                    });
                    
                    // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è Chrome: —Å–æ–±—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ TronLink
                    window.addEventListener('load', () => {
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        setTimeout(() => {
                            this.diagnosticTronLink();
                            this.checkAutoConnectPassive();
                        }, 1500);
                    });
                    
                    // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è TronLink –≤ Chrome
                    document.addEventListener('tronLink#initialized', () => {
                        this.log('‚úì TronLink –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (Chrome)', 'success');
                        this.diagnosticTronLink();
                        this.checkAutoConnectPassive();
                    });
                },
                
                diagnosticTronLink() {
                    // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å TronLink
                    console.log('=== TronLink Diagnostic ===');
                    console.log('window.tronWeb:', window.tronWeb);
                    console.log('window.tronLink:', window.tronLink);
                    
                    if (window.tronWeb) {
                        console.log('  tronWeb.ready:', window.tronWeb.ready);
                        console.log('  tronWeb.defaultAddress:', window.tronWeb.defaultAddress);
                        
                        // –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ defaultAddress
                        const addr = window.tronWeb.defaultAddress;
                        console.log('  defaultAddress type:', typeof addr);
                        console.log('  defaultAddress.base58:', addr.base58);
                        console.log('  defaultAddress.hex:', addr.hex);
                        
                        // –ü–æ–ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞
                        if (addr.base58) {
                            console.log('  ‚úÖ Address from base58:', addr.base58);
                        } else {
                            console.log('  ‚ö†Ô∏è defaultAddress.base58 is false');
                        }
                    }
                    
                    this.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ TronLink...', 'info');
                    
                    if (typeof window.tronWeb === 'undefined' && typeof window.tronLink === 'undefined') {
                        this.log('  ‚ö† TronLink –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω', 'warning');
                        this.log('  üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏ –≤–∫–ª—é—á–µ–Ω–æ', 'warning');
                    } else if (window.tronWeb && !window.tronWeb.ready) {
                        this.log('  ‚ö† TronLink –Ω–∞–π–¥–µ–Ω, –Ω–æ –Ω–µ –≥–æ—Ç–æ–≤ (–∫–æ—à–µ–ª–µ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)', 'warning');
                    } else if (window.tronWeb && window.tronWeb.ready) {
                        this.log('  ‚úì TronLink –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
                    }
                },
            
                checkAutoConnectPassive() {
                    // –ü–∞—Å—Å–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–æ–≤
                    try {
                        if (typeof window.tronWeb !== 'undefined' && 
                            window.tronWeb.ready && 
                            window.tronWeb.defaultAddress && 
                            window.tronWeb.defaultAddress.base58 &&
                            window.tronWeb.defaultAddress.base58 !== false) {
                            
                            this.tronWeb = window.tronWeb;
                            this.walletAddress = window.tronWeb.defaultAddress.base58;
                            this.walletConnected = true;
                            this.log('‚úì TronLink —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω: ' + this.walletAddress, 'success');
                        }
                    } catch (error) {
                        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–∞—Å—Å–∏–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
                        console.log('Passive check:', error.message);
                    }
                }
            },
            async mounted() {
                this.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
                this.log('–ë—Ä–∞—É–∑–µ—Ä: ' + navigator.userAgent.split(' ').pop(), 'info');
                this.log('–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ TronLink –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ TRON Mainnet', 'warning');
                this.log('–ê–∫–∫–∞—É–Ω—Ç Owner1 –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å multisig permissions (2/3)', 'warning');
                
                // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ TronLink
                this.diagnosticTronLink();
                
                // Setup TronLink event listeners
                this.setupTronLinkListeners();
                
                // Wait a bit for TronLink to inject in Chrome
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Simple passive check - don't trigger TronLink popup
                this.checkAutoConnectPassive();
            }
        });
    </script>
</body>
</html>
