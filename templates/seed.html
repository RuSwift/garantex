<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞–Ω–∏–µ ETH –∫–ª—é—á–∞ - Garantex</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
            text-align: center;
        }

        .method-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .method-btn {
            flex: 1;
            padding: 20px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .method-btn:hover {
            border-color: #667eea;
            background: #f5f5ff;
            transform: translateY(-2px);
        }

        .method-btn.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .method-content {
            display: none;
        }

        .method-content.active {
            display: block;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .status.error {
            background: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }

        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #90caf9;
        }

        .status.success {
            background: #e8f5e9;
            color: #388e3c;
            border: 1px solid #81c784;
        }

        .mnemonic-section {
            margin-bottom: 20px;
        }

        .mnemonic-section label {
            display: block;
            color: #666;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .mnemonic-section textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }

        .mnemonic-section textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .mouse-entropy-section {
            margin-bottom: 20px;
        }

        .entropy-canvas {
            width: 100%;
            height: 300px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: crosshair;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            position: relative;
            overflow: hidden;
        }

        .entropy-canvas.collecting {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }

        .entropy-progress {
            margin-top: 15px;
            margin-bottom: 15px;
        }

        .entropy-progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .entropy-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            border-radius: 10px;
        }

        .entropy-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: 600;
            color: #333;
        }

        .entropy-instructions {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-bottom: 15px;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        button.secondary {
            background: #f5f5f5;
            color: #333;
        }

        button.secondary:hover:not(:disabled) {
            background: #e0e0e0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .result-section {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .result-section.active {
            display: block;
        }

        .result-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .result-item {
            margin-bottom: 15px;
        }

        .result-item label {
            display: block;
            color: #666;
            margin-bottom: 5px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .result-item .value {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #333;
        }

        .copy-btn {
            margin-top: 5px;
            padding: 8px 15px;
            font-size: 12px;
            width: auto;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .warning strong {
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîë –°–æ–∑–¥–∞–Ω–∏–µ ETH –∫–ª—é—á–∞</h1>
        <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–∞ –ø–æ —ç–Ω—Ç—Ä–æ–ø–∏–∏</p>

        <div id="status" class="status hidden"></div>

        <div class="method-selector">
            <button class="method-btn active" data-method="mnemonic">
                üìù –ú–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫–∞—è —Ñ—Ä–∞–∑–∞
            </button>
            <button class="method-btn" data-method="mouse">
                üñ±Ô∏è –î–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∫–æ–π
            </button>
        </div>

        <!-- –ú–µ—Ç–æ–¥: –ú–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫–∞—è —Ñ—Ä–∞–∑–∞ -->
        <div id="mnemonic-method" class="method-content active">
            <div class="warning">
                <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong>
                –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–µ–π –º–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫–æ–π —Ñ—Ä–∞–∑–æ–π —Å —Ç—Ä–µ—Ç—å–∏–º–∏ –ª–∏—Ü–∞–º–∏. 
                –•—Ä–∞–Ω–∏—Ç–µ –µ—ë –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ.
            </div>
            <div class="mnemonic-section">
                <label for="mnemonic-input">–í–≤–µ–¥–∏—Ç–µ –º–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫—É—é —Ñ—Ä–∞–∑—É (12 –∏–ª–∏ 24 —Å–ª–æ–≤–∞):</label>
                <textarea 
                    id="mnemonic-input" 
                    placeholder="word1 word2 word3 ... word12"
                ></textarea>
            </div>
            <button id="generate-from-mnemonic-btn">
                –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –∏–∑ –º–Ω–µ–º–æ–Ω–∏–∫–∏
            </button>
        </div>

        <!-- –ú–µ—Ç–æ–¥: –î–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∫–æ–π -->
        <div id="mouse-method" class="method-content">
            <div class="warning">
                <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</strong>
                –î–≤–∏–≥–∞–π—Ç–µ –º—ã—à–∫–æ–π –ø–æ —ç–∫—Ä–∞–Ω—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–Ω—Ç—Ä–æ–ø–∏–∏. 
                –ß–µ–º –±–æ–ª—å—à–µ –¥–≤–∏–∂–µ–Ω–∏–π, —Ç–µ–º –≤—ã—à–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–ª—é—á–∞.
            </div>
            <div class="mouse-entropy-section">
                <div class="entropy-instructions" id="entropy-instructions">
                    –î–≤–∏–≥–∞–π—Ç–µ –º—ã—à–∫–æ–π –ø–æ –æ–±–ª–∞—Å—Ç–∏ –Ω–∏–∂–µ –¥–ª—è —Å–±–æ—Ä–∞ —ç–Ω—Ç—Ä–æ–ø–∏–∏
                </div>
                <div class="entropy-progress">
                    <div class="entropy-progress-bar">
                        <div class="entropy-progress-fill" id="entropy-progress-fill" style="width: 0%"></div>
                        <div class="entropy-progress-text" id="entropy-progress-text">0%</div>
                    </div>
                </div>
                <canvas id="entropy-canvas" class="entropy-canvas"></canvas>
            </div>
            <button id="generate-from-mouse-btn" disabled>
                –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –∏–∑ —ç–Ω—Ç—Ä–æ–ø–∏–∏
            </button>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div id="result-section" class="result-section">
            <h3>‚úÖ –ö–ª—é—á —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω</h3>
            
            <div class="result-item">
                <label>–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞:</label>
                <div class="value" id="wallet-address">-</div>
                <button class="copy-btn secondary" onclick="copyToClipboard('wallet-address')">
                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å
                </button>
            </div>

            <div class="result-item">
                <label>–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á:</label>
                <div class="value" id="private-key">-</div>
                <button class="copy-btn secondary" onclick="copyToClipboard('private-key')">
                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á
                </button>
            </div>

            <div class="result-item" id="mnemonic-result-item" style="display: none;">
                <label>–ú–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫–∞—è —Ñ—Ä–∞–∑–∞:</label>
                <div class="value" id="generated-mnemonic">-</div>
                <button class="copy-btn secondary" onclick="copyToClipboard('generated-mnemonic')">
                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ—Ä–∞–∑—É
                </button>
            </div>

            <div class="warning" style="margin-top: 20px;">
                <strong>üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</strong>
                –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ. 
                –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∏ –º–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫–∞—è —Ñ—Ä–∞–∑–∞ –¥–∞—é—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ—à–µ–ª—å–∫—É.
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentMethod = 'mnemonic';
        let mouseEntropy = [];
        let entropyProgress = 0;
        const REQUIRED_ENTROPY = 256; // –±–∏—Ç —ç–Ω—Ç—Ä–æ–ø–∏–∏ (32 –±–∞–π—Ç–∞)
        let canvas, ctx;
        let isCollecting = false;
        let lastX = 0, lastY = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            initMethodSelector();
            initMnemonicMethod();
            initMouseMethod();
        });

        // –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞
        function initMethodSelector() {
            const methodBtns = document.querySelectorAll('.method-btn');
            methodBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const method = this.dataset.method;
                    switchMethod(method);
                });
            });
        }

        function switchMethod(method) {
            currentMethod = method;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.method-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-method="${method}"]`).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            document.querySelectorAll('.method-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${method}-method`).classList.add('active');
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            document.getElementById('result-section').classList.remove('active');
            hideStatus();
        }

        // –ú–µ—Ç–æ–¥: –ú–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫–∞—è —Ñ—Ä–∞–∑–∞
        function initMnemonicMethod() {
            const btn = document.getElementById('generate-from-mnemonic-btn');
            btn.addEventListener('click', generateFromMnemonic);
        }

        async function generateFromMnemonic() {
            const mnemonicInput = document.getElementById('mnemonic-input').value.trim();
            
            if (!mnemonicInput) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ –º–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫—É—é —Ñ—Ä–∞–∑—É', 'error');
                return;
            }

            try {
                showStatus('–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞...', 'info');
                const btn = document.getElementById('generate-from-mnemonic-btn');
                btn.disabled = true;
                btn.innerHTML = '<span class="loading"></span>–°–æ–∑–¥–∞–Ω–∏–µ...';

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –º–Ω–µ–º–æ–Ω–∏–∫—É
                const words = mnemonicInput.split(/\s+/).filter(w => w.length > 0);
                
                if (words.length !== 12 && words.length !== 24) {
                    throw new Error('–ú–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫–∞—è —Ñ—Ä–∞–∑–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å 12 –∏–ª–∏ 24 —Å–ª–æ–≤–∞');
                }

                // –°–æ–∑–¥–∞–µ–º –∫–æ—à–µ–ª–µ–∫ –∏–∑ –º–Ω–µ–º–æ–Ω–∏–∫–∏
                const wallet = ethers.Wallet.fromMnemonic(words.join(' '));
                
                displayResult(wallet, mnemonicInput);
                showStatus('–ö–ª—é—á —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                
            } catch (error) {
                console.error('Error:', error);
                showStatus('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            } finally {
                const btn = document.getElementById('generate-from-mnemonic-btn');
                btn.disabled = false;
                btn.innerHTML = '–°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –∏–∑ –º–Ω–µ–º–æ–Ω–∏–∫–∏';
            }
        }

        // –ú–µ—Ç–æ–¥: –î–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∫–æ–π
        function initMouseMethod() {
            canvas = document.getElementById('entropy-canvas');
            ctx = canvas.getContext('2d');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä canvas
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseleave', handleMouseUp);

            // –ö–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            const btn = document.getElementById('generate-from-mouse-btn');
            btn.addEventListener('click', generateFromMouseEntropy);
        }

        function handleMouseDown(e) {
            isCollecting = true;
            const rect = canvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
            canvas.classList.add('collecting');
        }

        function handleMouseUp() {
            isCollecting = false;
            canvas.classList.remove('collecting');
        }

        function handleMouseMove(e) {
            if (!isCollecting) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const time = Date.now();

            // –°–æ–±–∏—Ä–∞–µ–º —ç–Ω—Ç—Ä–æ–ø–∏—é: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –≤—Ä–µ–º—è, —Å–ª—É—á–∞–π–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const entropyData = {
                x: x,
                y: y,
                dx: x - lastX,
                dy: y - lastY,
                time: time,
                random: Math.random()
            };

            mouseEntropy.push(entropyData);

            // –†–∏—Å—É–µ–º —Å–ª–µ–¥
            ctx.strokeStyle = `hsl(${(time % 360)}, 70%, 50%)`;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();

            lastX = x;
            lastY = y;

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            updateEntropyProgress();
        }

        function updateEntropyProgress() {
            // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞: –∫–∞–∂–¥–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç ~0.5-1 –±–∞–π—Ç —ç–Ω—Ç—Ä–æ–ø–∏–∏
            const estimatedBytes = mouseEntropy.length * 0.7;
            entropyProgress = Math.min(100, (estimatedBytes / REQUIRED_ENTROPY) * 100);

            document.getElementById('entropy-progress-fill').style.width = entropyProgress + '%';
            document.getElementById('entropy-progress-text').textContent = 
                Math.round(entropyProgress) + '%';

            const btn = document.getElementById('generate-from-mouse-btn');
            if (entropyProgress >= 100) {
                btn.disabled = false;
                document.getElementById('entropy-instructions').textContent = 
                    '–≠–Ω—Ç—Ä–æ–ø–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ! –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞.';
            } else {
                btn.disabled = true;
                document.getElementById('entropy-instructions').textContent = 
                    `–î–≤–∏–≥–∞–π—Ç–µ –º—ã—à–∫–æ–π –ø–æ –æ–±–ª–∞—Å—Ç–∏ (${Math.round(entropyProgress)}%)`;
            }
        }

        async function generateFromMouseEntropy() {
            if (mouseEntropy.length < 50) {
                showStatus('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω—Ç—Ä–æ–ø–∏–∏. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –¥–≤–∏–≥–∞—Ç—å –º—ã—à–∫–æ–π.', 'error');
                return;
            }

            try {
                showStatus('–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ –∏–∑ —ç–Ω—Ç—Ä–æ–ø–∏–∏...', 'info');
                const btn = document.getElementById('generate-from-mouse-btn');
                btn.disabled = true;
                btn.innerHTML = '<span class="loading"></span>–°–æ–∑–¥–∞–Ω–∏–µ...';

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º seed –∏–∑ —ç–Ω—Ç—Ä–æ–ø–∏–∏ –º—ã—à–∏ (16 –±–∞–π—Ç –¥–ª—è 12 —Å–ª–æ–≤)
                const seedBytes = await generateSeedFromMouseEntropy(16); // 16 –±–∞–π—Ç = 128 –±–∏—Ç –¥–ª—è 12 —Å–ª–æ–≤
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–Ω–µ–º–æ–Ω–∏–∫—É –∏–∑ seed –∏—Å–ø–æ–ª—å–∑—É—è BIP39
                const mnemonic = await generateMnemonicFromSeed(seedBytes);
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ—à–µ–ª–µ–∫ –∏–∑ –º–Ω–µ–º–æ–Ω–∏–∫–∏ (—ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–∞ –∏ –º–Ω–µ–º–æ–Ω–∏–∫–∏)
                const wallet = ethers.Wallet.fromMnemonic(mnemonic);
                
                displayResult(wallet, mnemonic, true);
                showStatus('–ö–ª—é—á —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                
            } catch (error) {
                console.error('Error:', error);
                showStatus('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            } finally {
                const btn = document.getElementById('generate-from-mouse-btn');
                btn.disabled = false;
                btn.innerHTML = '–°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –∏–∑ —ç–Ω—Ç—Ä–æ–ø–∏–∏';
            }
        }

        async function generateSeedFromMouseEntropy(byteLength = 16) {
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —ç–Ω—Ç—Ä–æ–ø–∏–∏
            let entropyData = '';
            
            mouseEntropy.forEach(entropy => {
                entropyData += entropy.x + ',' + entropy.y + ',' + entropy.dx + ',' + 
                              entropy.dy + ',' + entropy.time + ',' + entropy.random + '|';
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å
            entropyData += Math.random() + ',' + Date.now() + ',' + 
                          performance.now() + ',' + Math.random() + ',' +
                          crypto.getRandomValues(new Uint8Array(16)).join(',');

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º PBKDF2 –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–æ–≥–æ seed
            const encoder = new TextEncoder();
            const data = encoder.encode(entropyData);
            const salt = encoder.encode('garantex-seed-salt-' + Date.now());
            
            // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª—é—á –¥–ª—è PBKDF2
            const keyMaterial = await crypto.subtle.importKey(
                'raw',
                data,
                { name: 'PBKDF2' },
                false,
                ['deriveBits']
            );

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º seed –∏—Å–ø–æ–ª—å–∑—É—è PBKDF2
            const derivedBits = await crypto.subtle.deriveBits(
                {
                    name: 'PBKDF2',
                    salt: salt,
                    iterations: 100000,
                    hash: 'SHA-256'
                },
                keyMaterial,
                byteLength * 8 // –±–∏—Ç—ã
            );

            return new Uint8Array(derivedBits);
        }

        async function generateMnemonicFromSeed(seedBytes) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º BIP39 –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–Ω–µ–º–æ–Ω–∏–∫–∏ –∏–∑ seed
            // seedBytes –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 16 –±–∞–π—Ç (128 –±–∏—Ç) –¥–ª—è 12 —Å–ª–æ–≤ –∏–ª–∏ 32 –±–∞–π—Ç–∞ (256 –±–∏—Ç) –¥–ª—è 24 —Å–ª–æ–≤
            
            try {
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º seed –≤ hex —Å—Ç—Ä–æ–∫—É
                const seedHex = Array.from(seedBytes)
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º ethers –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–Ω–µ–º–æ–Ω–∏–∫–∏ –∏–∑ entropy
                // Ethers –æ–∂–∏–¥–∞–µ—Ç entropy –≤ –≤–∏–¥–µ hex —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ 0x
                const entropy = '0x' + seedHex;
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–Ω–µ–º–æ–Ω–∏–∫—É –∏–∑ entropy
                const mnemonic = ethers.utils.entropyToMnemonic(entropy);
                
                return mnemonic;
            } catch (error) {
                console.error('Error generating mnemonic:', error);
                // Fallback: —Å–æ–∑–¥–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –º–Ω–µ–º–æ–Ω–∏–∫—É
                const wallet = ethers.Wallet.createRandom();
                return wallet.mnemonic.phrase;
            }
        }

        function displayResult(wallet, mnemonic, showMnemonic = false) {
            document.getElementById('wallet-address').textContent = wallet.address;
            document.getElementById('private-key').textContent = wallet.privateKey;
            
            if (showMnemonic && mnemonic) {
                document.getElementById('generated-mnemonic').textContent = mnemonic;
                document.getElementById('mnemonic-result-item').style.display = 'block';
            } else {
                document.getElementById('mnemonic-result-item').style.display = 'none';
            }
            
            document.getElementById('result-section').classList.add('active');
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                showStatus('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                setTimeout(hideStatus, 2000);
            }).catch(err => {
                showStatus('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
            });
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.classList.remove('hidden');
        }

        function hideStatus() {
            document.getElementById('status').classList.add('hidden');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', function() {
            if (canvas) {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }
        });
    </script>
</body>
</html>

